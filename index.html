<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#222222">
    <link rel="manifest" href="manifest.json">
    <title>GRNDbrekers Rodeo Bull - StuDAY 2025</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: white;
        }

        .screen {
            display: none;
            flex: 1;
            justify-content: center;
            align-items: center;
            padding: 20px;
            text-align: center;
        }

        .screen.active {
            display: flex;
        }

        .screen-content {
            max-width: 400px;
            width: 100%;
        }

        .logo-container {
            margin-bottom: 30px;
        }

        .logo {
            width: 300px;
            height: 180px;
            margin: 0 auto 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .logo img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 15px;
        }

        .btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            min-height: 50px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: inline-block;
            width: auto;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .input-field, select.input-field {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 16px;
            backdrop-filter: blur(10px);
        }

        .input-field::placeholder {
            color: rgba(255,255,255,0.7);
        }

        select.input-field {
            color: white;
            background: rgba(255,255,255,0.1);
        }

        select.input-field option {
            background: #333;
            color: white;
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
        }

        .rider-tag {
            display: inline-block;
            background: rgba(76,175,80,0.3);
            color: white;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 20px;
            border: 1px solid #4CAF50;
            font-size: 14px;
            position: relative;
        }

        .rider-tag .remove-btn {
            margin-left: 8px;
            cursor: pointer;
            color: #ff6b35;
            font-weight: bold;
        }

        .time-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }

        .leaderboard-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .leaderboard-logo {
            max-width: 350px;
            max-height: 150px;
            object-fit: contain;
            margin: 0 auto 25px;
            display: block;
            border-radius: 15px;
        }

        .top-three-container {
            display: flex;
            justify-content: center;
            align-items: end;
            margin: 20px 0;
            gap: 10px;
        }

        .top-rider {
            text-align: center;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 15px;
            backdrop-filter: blur(10px);
            min-width: 80px;
        }

        .top-rider.first {
            order: 2;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(255,215,0,0.3);
        }

        .top-rider.second {
            order: 1;
            background: linear-gradient(135deg, #C0C0C0, #A0A0A0);
            color: #000;
        }

        .top-rider.third {
            order: 3;
            background: linear-gradient(135deg, #CD7F32, #B8860B);
            color: #fff;
        }

        .top-rider-medal {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .top-rider.first .top-rider-medal {
            font-size: 24px;
        }

        .top-rider-name {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .top-rider.first .top-rider-name {
            font-size: 16px;
        }

        .top-rider-time {
            font-size: 12px;
            opacity: 0.8;
        }

        .top-rider.first .top-rider-time {
            font-size: 14px;
            opacity: 1;
            font-weight: bold;
        }

        .remaining-riders {
            margin-top: 30px;
        }

        .remaining-riders h3 {
            text-align: center;
            margin-bottom: 15px;
            opacity: 0.8;
            font-size: 16px;
        }

        .remaining-leaderboard {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 10px;
        }

        .remaining-entry {
            background: rgba(255,255,255,0.1);
            margin: 8px 0;
            padding: 12px;
            border-radius: 10px;
            display: grid;
            grid-template-columns: 40px 1fr 80px;
            gap: 10px;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .remaining-position {
            font-weight: bold;
            text-align: center;
            font-size: 16px;
        }

        .remaining-name {
            font-weight: bold;
            font-size: 14px;
        }

        .remaining-time {
            text-align: center;
            font-weight: bold;
            font-size: 14px;
        }

        h1, h2 {
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .added-names {
            max-height: 200px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .debug {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 9999;
        }

        @media (max-width: 480px) {
            .leaderboard-logo {
                max-width: 280px;
                max-height: 120px;
            }
            
            .time-inputs {
                grid-template-columns: 1fr;
            }
            
            .screen-content {
                padding: 10px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 16px;
            }
            
            .top-three-container {
                flex-direction: column;
                align-items: center;
            }

            .top-rider {
                order: unset !important;
                margin-bottom: 10px;
                min-width: 150px;
                transform: none !important;
            }
            
            .top-rider.first {
                transform: scale(1.05) !important;
            }
            
            .remaining-entry {
                grid-template-columns: 35px 1fr 70px;
                gap: 8px;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="debug" id="debug">Loading...</div>

    <!-- Home Screen -->
    <div class="screen active" id="homeScreen">
        <div class="screen-content">
            <div class="logo-container">
                <div class="logo">
                    <img src="https://raw.githubusercontent.com/SergeHanssens/grndbrekers-bull-studay2025/images/grndbrekers-bull-logo.jpg" 
                         alt="GRNDbrekers Logo"
                         onerror="this.outerHTML='<div style=color:white;font-size:18px;>üõ†Ô∏è GRNDbrekers üêÇ<br><small>Bull Riding Leaderboard</small></div>';">
                </div>
            </div>
            <button class="btn" onclick="showScreen('nameEntryScreen')">Start Leaderboard!</button>
        </div>
    </div>

    <!-- Name Entry Screen -->
    <div class="screen" id="nameEntryScreen">
        <button class="back-btn" onclick="showScreen('homeScreen')">‚Üê Terug</button>
        <div class="screen-content">
            <h2>Voeg Rijders Toe</h2>
            <input type="text" class="input-field" id="riderName" placeholder="Naam van rijder">
            <div class="added-names" id="addedNames"></div>
            <button class="btn" onclick="addRider()">+ Voeg Rijder Toe</button>
            <div style="margin-top: 20px;">
                <button class="btn" onclick="showScreen('timeEntryScreen')" id="nextToTimeBtn" style="display: none;">Naar Tijden ‚Üí</button>
                <button class="btn" onclick="showScreen('leaderboardScreen')" style="background: linear-gradient(45deg, #FFD700, #FFA500);">üèÜ Bekijk Leaderboard</button>
            </div>
        </div>
    </div>

    <!-- Time Entry Screen -->
    <div class="screen" id="timeEntryScreen">
        <button class="back-btn" onclick="showScreen('nameEntryScreen')">‚Üê Terug</button>
        <div class="screen-content">
            <h2>Voeg Tijd Toe</h2>
            <select class="input-field" id="riderSelect">
                <option value="">Selecteer rijder...</option>
            </select>
            
            <div class="time-inputs">
                <input type="number" class="input-field" id="minutes" placeholder="Min" min="0" max="59">
                <input type="number" class="input-field" id="seconds" placeholder="Sec" min="0" max="59">
                <input type="number" class="input-field" id="hundredths" placeholder="1/100" min="0" max="99">
            </div>
            <button class="btn" onclick="addTime()">Voeg Tijd Toe</button>
            <div style="margin-top: 20px;">
                <button class="btn" onclick="showScreen('nameEntryScreen')" style="background: linear-gradient(45deg, #2196F3, #1976D2);">‚Üê Naar Rijders</button>
                <button class="btn" onclick="showScreen('leaderboardScreen')">Bekijk Leaderboard</button>
            </div>
        </div>
    </div>

    <!-- Leaderboard Screen -->
    <div class="screen" id="leaderboardScreen">
        <div class="screen-content">
            <!-- Logo Header -->
            <div class="leaderboard-header">
                <img src="https://raw.githubusercontent.com/SergeHanssens/grndbrekers-bull-studay2025/images/grndbrekers-bull-logo.jpg" 
                     alt="GRNDbrekers Logo" class="leaderboard-logo"
                     onerror="this.outerHTML='<h2 style=color:white;>üõ†Ô∏è GRNDbrekers Bull Riding</h2>';">
            </div>
            
            <!-- Top 3 -->
            <div id="topThree"></div>
            
            <!-- Rest in scrollable -->
            <div class="remaining-riders" id="remainingRidersSection">
                <h3>Overige Rankings:</h3>
                <div id="remainingLeaderboard"></div>
            </div>
            
            <div style="margin-top: 30px;">
                <button class="btn" onclick="showScreen('timeEntryScreen')">‚Üê Tijden Toevoegen</button>
                <button class="btn" onclick="showScreen('nameEntryScreen')">Nieuwe Rijders</button>
                <button class="btn" onclick="resetAll()" style="background: linear-gradient(45deg, #dc2626, #b91c1c);">üóëÔ∏è Reset</button>
            </div>
        </div>
    </div>

    <script>
        // Debug function
        function updateDebug(message) {
            const debug = document.getElementById('debug');
            if (debug) debug.textContent = message;
            console.log('DEBUG:', message);
        }

        updateDebug('Script starting...');

        // Global variables
        window.riders = [];
        window.leaderboardData = [];

        // Simple screen navigation
        window.showScreen = function(screenId) {
            updateDebug('Switching to: ' + screenId);
            
            // Hide all screens
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => screen.classList.remove('active'));
            
            // Show target screen
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.add('active');
                updateDebug('Screen active: ' + screenId);
                
                // Update dropdown when going to time screen
                if (screenId === 'timeEntryScreen') {
                    updateRiderDropdown();
                }
                
                // Update leaderboard when viewing
                if (screenId === 'leaderboardScreen') {
                    updateLeaderboard();
                }
            } else {
                updateDebug('ERROR: Screen not found: ' + screenId);
            }
        }

        // Add rider function
        window.addRider = function() {
            updateDebug('Adding rider...');
            
            const nameInput = document.getElementById('riderName');
            const name = nameInput ? nameInput.value.trim() : '';
            
            if (!name) {
                alert('Voer een naam in!');
                return;
            }
            
            // Check if exists
            if (window.riders.find(r => r.name.toLowerCase() === name.toLowerCase())) {
                alert('Deze naam bestaat al!');
                return;
            }
            
            // Add rider
            window.riders.push({
                name: name,
                time: null,
                timeValue: null,
                timestamp: new Date().toISOString()
            });
            
            // Clear input
            nameInput.value = '';
            
            // Save and update
            saveData();
            updateRidersList();
            updateRiderDropdown();
            
            // Show next button if we have riders
            const nextBtn = document.getElementById('nextToTimeBtn');
            if (nextBtn && window.riders.length > 0) {
                nextBtn.style.display = 'inline-block';
            }
            
            updateDebug('Rider added: ' + name + ' (total: ' + window.riders.length + ')');
        }

        // Remove rider function  
        window.removeRider = function(index) {
            updateDebug('Removing rider at index: ' + index);
            
            if (window.riders[index]) {
                const rider = window.riders[index];
                
                // Remove from leaderboard if has time
                if (rider.time) {
                    window.leaderboardData = window.leaderboardData.filter(entry => entry.name !== rider.name);
                }
                
                // Remove from riders
                window.riders.splice(index, 1);
                
                // Update UI
                saveData();
                updateRidersList();
                updateRiderDropdown();
                updateLeaderboard();
                
                updateDebug('Rider removed. Remaining: ' + window.riders.length);
            }
        }

        // Update riders list
        function updateRidersList() {
            const container = document.getElementById('addedNames');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Only show riders without time
            const ridersWithoutTime = window.riders.filter(r => !r.time);
            
            ridersWithoutTime.forEach((rider) => {
                const fullIndex = window.riders.findIndex(r => r.name === rider.name);
                
                const tag = document.createElement('div');
                tag.className = 'rider-tag';
                tag.innerHTML = `
                    ${rider.name}
                    <span class="remove-btn" onclick="removeRider(${fullIndex})">√ó</span>
                `;
                container.appendChild(tag);
            });
            
            if (ridersWithoutTime.length === 0 && window.riders.length > 0) {
                container.innerHTML = '<p style="text-align: center; opacity: 0.7;">Alle rijders hebben al een tijd!</p>';
            }
        }

        // Update dropdown
        function updateRiderDropdown() {
            const select = document.getElementById('riderSelect');
            if (!select) return;
            
            select.innerHTML = '<option value="">Selecteer rijder...</option>';
            
            // Only riders without time
            window.riders.forEach((rider, index) => {
                if (!rider.time) {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = rider.name;
                    select.appendChild(option);
                }
            });
        }

        // Add time function
        window.addTime = function() {
            updateDebug('Adding time...');
            
            const riderIndex = document.getElementById('riderSelect').value;
            const minutes = document.getElementById('minutes').value || '0';
            const seconds = document.getElementById('seconds').value || '0';
            const hundredths = document.getElementById('hundredths').value || '0';

            if (!riderIndex && riderIndex !== '0') {
                alert('Selecteer een rijder!');
                return;
            }

            const timeString = `${minutes.padStart(2, '0')}:${seconds.padStart(2, '0')}:${hundredths.padStart(2, '0')}`;
            const timeValue = parseInt(minutes) * 6000 + parseInt(seconds) * 100 + parseInt(hundredths);

            // Update rider
            window.riders[riderIndex].time = timeString;
            window.riders[riderIndex].timeValue = timeValue;

            // Add to leaderboard
            const entry = {
                name: window.riders[riderIndex].name,
                time: timeString,
                timeValue: timeValue,
                timestamp: new Date().toISOString()
            };

            // Remove existing entry if any
            window.leaderboardData = window.leaderboardData.filter(e => e.name !== entry.name);
            window.leaderboardData.push(entry);
            
            // Sort by time (SHORTEST first - who fell off first)
            window.leaderboardData.sort((b, a) => a.timeValue - b.timeValue);
            
            // Keep ALL entries (no limit)

            // Save and update
            saveData();
            updateRidersList();
            updateRiderDropdown();
            
            // Clear form
            document.getElementById('riderSelect').value = '';
            document.getElementById('minutes').value = '';
            document.getElementById('seconds').value = '';
            document.getElementById('hundredths').value = '';
            
            alert(`‚úÖ Tijd toegevoegd voor ${entry.name}: ${timeString}`);
            updateDebug('Time added for: ' + entry.name);
        }

        // Update leaderboard display with top 3 + scrollable rest
        function updateLeaderboard() {
            updateTopThree();
            updateRemainingLeaderboard();
        }

        // Update top 3 podium
        function updateTopThree() {
            const container = document.getElementById('topThree');
            if (!container) return;
            
            container.innerHTML = '';
            
            const topThree = window.leaderboardData.slice(0, 3);
            
            if (topThree.length === 0) {
                container.innerHTML = '<p style="text-align: center; opacity: 0.7;">Nog geen tijden toegevoegd...</p>';
                return;
            }
            
            const topThreeContainer = document.createElement('div');
            topThreeContainer.className = 'top-three-container';
            
            topThree.forEach((entry, index) => {
                const positions = ['first', 'second', 'third'];
                const medals = ['ü•á', 'ü•à', 'ü•â'];
                
                const riderDiv = document.createElement('div');
                riderDiv.className = `top-rider ${positions[index]}`;
                
                riderDiv.innerHTML = `
                    <div class="top-rider-medal">${medals[index]}</div>
                    <div class="top-rider-name">${entry.name}</div>
                    <div class="top-rider-time">${entry.time}</div>
                `;
                
                topThreeContainer.appendChild(riderDiv);
            });
            
            container.appendChild(topThreeContainer);
        }

        // Update remaining leaderboard (positions 4+)
        function updateRemainingLeaderboard() {
            const container = document.getElementById('remainingLeaderboard');
            const section = document.getElementById('remainingRidersSection');
            if (!container || !section) return;
            
            const remainingEntries = window.leaderboardData.slice(3);
            
            if (remainingEntries.length === 0) {
                // Hide the entire section if no remaining entries
                section.style.display = 'none';
                return;
            }
            
            // Show section if we have remaining entries
            section.style.display = 'block';
            
            const remainingContainer = document.createElement('div');
            remainingContainer.className = 'remaining-leaderboard';
            
            remainingEntries.forEach((entry, index) => {
                const position = index + 4; // Start from position 4
                
                const entryDiv = document.createElement('div');
                entryDiv.className = 'remaining-entry';
                
                entryDiv.innerHTML = `
                    <div class="remaining-position">#${position}</div>
                    <div class="remaining-name">${entry.name}</div>
                    <div class="remaining-time">${entry.time}</div>
                `;
                
                remainingContainer.appendChild(entryDiv);
            });
            
            container.innerHTML = '';
            container.appendChild(remainingContainer);
        }

        // Save data to localStorage
        function saveData() {
            try {
                localStorage.setItem('rodeoRiders', JSON.stringify(window.riders));
                localStorage.setItem('rodeoLeaderboard', JSON.stringify(window.leaderboardData));
                updateDebug('Data saved');
            } catch (e) {
                updateDebug('Save failed: ' + e.message);
            }
        }

        // Load data from localStorage
        function loadData() {
            try {
                const savedRiders = localStorage.getItem('rodeoRiders');
                const savedLeaderboard = localStorage.getItem('rodeoLeaderboard');
                
                if (savedRiders) {
                    window.riders = JSON.parse(savedRiders);
                    updateDebug('Loaded ' + window.riders.length + ' riders');
                }
                
                if (savedLeaderboard) {
                    window.leaderboardData = JSON.parse(savedLeaderboard);
                    updateDebug('Loaded ' + window.leaderboardData.length + ' leaderboard entries');
                }
            } catch (e) {
                updateDebug('Load failed: ' + e.message);
                window.riders = [];
                window.leaderboardData = [];
            }
        }

        // Reset all data
        window.resetAll = function() {
            if (confirm('Weet je zeker dat je alle data wilt wissen?')) {
                window.riders = [];
                window.leaderboardData = [];
                localStorage.removeItem('rodeoRiders');
                localStorage.removeItem('rodeoLeaderboard');
                
                updateRidersList();
                updateRiderDropdown();
                updateLeaderboard();
                
                const nextBtn = document.getElementById('nextToTimeBtn');
                if (nextBtn) nextBtn.style.display = 'none';
                
                showScreen('homeScreen');
                updateDebug('All data reset');
            }
        }

        // Initialize app
        function initApp() {
            updateDebug('Initializing app...');
            
            loadData();
            updateRidersList();
            updateRiderDropdown();
            updateLeaderboard();
            
            // Show next button if we have riders without time
            const ridersWithoutTime = window.riders.filter(r => !r.time);
            const nextBtn = document.getElementById('nextToTimeBtn');
            if (nextBtn && ridersWithoutTime.length > 0) {
                nextBtn.style.display = 'inline-block';
            }
            
            updateDebug('App ready! Functions loaded.');
            
            // Hide debug after 3 seconds
            setTimeout(() => {
                const debug = document.getElementById('debug');
                if (debug) debug.style.display = 'none';
            }, 3000);
        }

        // Start app when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }

        updateDebug('Script loaded');
    </script>
</body>
</html>
